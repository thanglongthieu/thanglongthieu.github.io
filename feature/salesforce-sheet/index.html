---
layout: default
title: "Salesforce Sheet | Pipeline Console"
description: "Inline-editable Salesforce-style sheet for tracking opportunities, stages, and exports."
---
<section class="space-y-8">
  <div class="flex flex-wrap items-center justify-between gap-4" id="about">
    <div>
      <p class="text-sm font-semibold text-blue-600">Salesforce utility</p>
      <h1 class="text-3xl font-bold text-slate-900">Salesforce Sheet</h1>
      <p class="text-slate-600 max-w-2xl">
        Rebuilt spreadsheet-style console for quick pipeline edits. Add opportunities, tweak stages, and export a CSV
        without leaving the browser.
      </p>
    </div>
    <div class="flex flex-wrap items-center gap-3">
      <a
        href="{{ '/' | relative_url }}"
        class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm hover:border-blue-300 hover:text-blue-700"
      >
        ‚Üê Back home
      </a>
      <button
        id="export-csv"
        type="button"
        class="inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-700 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-blue-200 hover:shadow-xl"
      >
        ‚¨áÔ∏è Export CSV
      </button>
      <button
        id="copy-clipboard"
        type="button"
        class="inline-flex items-center gap-2 rounded-xl border border-indigo-200 bg-indigo-50 px-4 py-2 text-sm font-semibold text-indigo-700 hover:border-indigo-300 hover:bg-indigo-100"
      >
        üìã Copy table
      </button>
    </div>
  </div>

  <div class="grid gap-6 lg:grid-cols-3">
    <div class="lg:col-span-2 space-y-4 rounded-2xl bg-white/80 p-6 shadow-sm ring-1 ring-slate-200">
      <div class="flex flex-wrap items-center justify-between gap-3">
        <div>
          <p class="text-sm font-semibold text-indigo-600">Pipeline sheet</p>
          <h2 class="text-xl font-bold text-slate-900">Inline editable rows</h2>
        </div>
        <label class="flex items-center gap-2 text-sm font-semibold text-slate-700">
          Stage filter
          <select id="stage-filter" class="rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500">
            <option value="">All stages</option>
          </select>
        </label>
      </div>
      <div class="overflow-hidden rounded-xl border border-slate-200 bg-white">
        <div id="sheet" class="min-h-[420px]"></div>
      </div>
      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/jspreadsheet-ce@5.4.4/dist/jspreadsheet.min.css"
      />
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsuites@4.17.2/dist/jsuites.min.css" />
      <script defer src="https://cdn.jsdelivr.net/npm/jspreadsheet-ce@5.4.4/dist/jspreadsheet.min.js"></script>
      <script defer src="https://cdn.jsdelivr.net/npm/jsuites@4.17.2/dist/jsuites.min.js"></script>
    </div>

    <div class="space-y-4">
      <div class="rounded-2xl bg-white/90 p-5 shadow-sm ring-1 ring-slate-200">
        <p class="text-sm font-semibold text-emerald-600">Add row</p>
        <h3 class="text-lg font-bold text-slate-900">Quick capture</h3>
        <form id="add-form" class="mt-3 space-y-3">
          <div class="grid grid-cols-1 gap-3">
            <label class="text-sm font-semibold text-slate-700">
              Owner
              <input name="owner" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500" placeholder="AE name" />
            </label>
            <label class="text-sm font-semibold text-slate-700">
              Account
              <input name="account" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Customer account" />
            </label>
            <label class="text-sm font-semibold text-slate-700">
              Opportunity
              <input name="opportunity" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Opportunity name" />
            </label>
            <label class="text-sm font-semibold text-slate-700">
              Amount ($)
              <input name="amount" type="number" min="0" step="100" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500" placeholder="25000" />
            </label>
            <label class="text-sm font-semibold text-slate-700">
              Stage
              <select name="stage" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500"></select>
            </label>
            <label class="text-sm font-semibold text-slate-700">
              Close date
              <input name="closeDate" type="date" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500" />
            </label>
            <label class="text-sm font-semibold text-slate-700">
              Notes
              <textarea name="notes" rows="2" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Next steps"></textarea>
            </label>
          </div>
          <button type="submit" class="w-full rounded-xl bg-gradient-to-r from-emerald-500 to-teal-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:shadow-md">Add to sheet</button>
        </form>
      </div>

      <div class="rounded-2xl bg-white/90 p-5 shadow-sm ring-1 ring-slate-200">
        <p class="text-sm font-semibold text-purple-600">Summary</p>
        <h3 class="text-lg font-bold text-slate-900">Pipeline health</h3>
        <dl id="summary" class="mt-3 space-y-2 text-sm text-slate-700"></dl>
      </div>
    </div>
  </div>
</section>

<script>
  (() => {
    const safeId = () => (window.crypto?.randomUUID ? window.crypto.randomUUID() : `row-${Date.now()}-${Math.random().toString(16).slice(2)}`);

    const stageOptions = ['Prospecting', 'Discovery', 'Proposal', 'Negotiation', 'Closed Won', 'Closed Lost'];

    const data = [
      {
        id: safeId(),
        owner: 'Andi Adams',
        account: 'Northern Trails',
        opportunity: 'Service Cloud rollout',
        amount: 42000,
        stage: 'Discovery',
        closeDate: '2024-11-08',
        notes: 'Mapping support channels'
      },
      {
        id: safeId(),
        owner: 'Anna Lee',
        account: 'S-Force Retail',
        opportunity: 'Commerce + OMS expansion',
        amount: 98000,
        stage: 'Proposal',
        closeDate: '2024-12-01',
        notes: 'Needs ROI deck and sandbox demo'
      },
      {
        id: safeId(),
        owner: 'Kai Brown',
        account: 'Blue Horizon',
        opportunity: 'Analytics Cloud pilot',
        amount: 30000,
        stage: 'Prospecting',
        closeDate: '2024-10-15',
        notes: 'Budget check in progress'
      }
    ];

    const stageFilter = document.getElementById('stage-filter');
    const summary = document.getElementById('summary');
    const addForm = document.getElementById('add-form');
    const exportCsvBtn = document.getElementById('export-csv');
    const copyBtn = document.getElementById('copy-clipboard');
    const sheetContainer = document.getElementById('sheet');

    const columnKeys = ['owner', 'account', 'opportunity', 'amount', 'stage', 'closeDate', 'notes'];

    const setStageOptions = (selectEl, includeAll = false) => {
      if (!selectEl) return;
      selectEl.innerHTML = '';

      if (includeAll) {
        const any = document.createElement('option');
        any.value = '';
        any.textContent = 'All stages';
        selectEl.appendChild(any);
      }

      stageOptions.forEach((stage) => {
        const option = document.createElement('option');
        option.value = stage;
        option.textContent = stage;
        selectEl.appendChild(option);
      });
    };

    const formatCurrency = (value) => {
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(Number(value || 0));
    };

    const mapToGridData = (rows) =>
      rows.map((row) => [row.owner, row.account, row.opportunity, row.amount, row.stage, row.closeDate, row.notes]);

    const renderSummary = () => {
      const totals = data.reduce(
        (acc, row) => {
          acc.count += 1;
          acc.amount += Number(row.amount) || 0;
          acc.byStage[row.stage] = (acc.byStage[row.stage] || 0) + 1;
          return acc;
        },
        { count: 0, amount: 0, byStage: {} }
      );

      summary.innerHTML = '';

      const totalItem = document.createElement('div');
      totalItem.className = 'flex items-center justify-between rounded-lg bg-slate-50 px-3 py-2';
      totalItem.innerHTML = `<span class="font-semibold text-slate-800">Opportunities</span><span class="font-bold text-slate-900">${totals.count}</span>`;
      summary.appendChild(totalItem);

      const amountItem = document.createElement('div');
      amountItem.className = 'flex items-center justify-between rounded-lg bg-slate-50 px-3 py-2';
      amountItem.innerHTML = `<span class="font-semibold text-slate-800">Pipeline amount</span><span class="font-bold text-emerald-600">${formatCurrency(totals.amount)}</span>`;
      summary.appendChild(amountItem);

      Object.entries(totals.byStage).forEach(([stage, count]) => {
        const row = document.createElement('div');
        row.className = 'flex items-center justify-between rounded-lg border border-slate-100 px-3 py-2';
        row.innerHTML = `<span class="text-slate-700">${stage}</span><span class="font-semibold text-slate-900">${count}</span>`;
        summary.appendChild(row);
      });
    };

    const stageSelect = addForm.elements.namedItem('stage');
    setStageOptions(stageFilter, true);
    setStageOptions(stageSelect);

    let filteredRows = data;
    let sheet;

    const refreshSheet = () => {
      if (!sheet) return;
      const filter = stageFilter.value;
      filteredRows = filter ? data.filter((row) => row.stage === filter) : data;
      sheet.setData(mapToGridData(filteredRows));
    };

    const handleLoadFailure = (message) => {
      sheetContainer.innerHTML = `<div class="p-4 text-sm text-rose-700 bg-rose-50 border border-rose-200 rounded-lg">${message}</div>`;
    };

    const waitForSpreadsheet = () =>
      new Promise((resolve, reject) => {
        let attempts = 0;
        const maxAttempts = 80;

        const poll = () => {
          const lib = window.jspreadsheet?.default || window.jspreadsheet || window.jSpreadsheet || window.jexcel;
          if (lib) {
            resolve(lib);
            return;
          }

          if (attempts++ > maxAttempts) {
            reject(new Error('jspreadsheet failed to load'));
            return;
          }

          requestAnimationFrame(poll);
        };

        poll();
      });

    waitForSpreadsheet()
      .then((spreadsheetLib) => {
        sheet = spreadsheetLib(sheetContainer, {
          data: mapToGridData(data),
          columns: [
            { title: 'Owner', width: 140 },
            { title: 'Account', width: 160 },
            { title: 'Opportunity', width: 200 },
            {
              title: 'Amount ($)',
              type: 'numeric',
              mask: '$ #,##0',
              decimal: '.',
              thousands: ',',
              width: 120
            },
            { title: 'Stage', type: 'dropdown', source: stageOptions, width: 150 },
            { title: 'Close Date', type: 'calendar', options: { format: 'YYYY-MM-DD' }, width: 140 },
            { title: 'Notes', type: 'text', wordWrap: true, width: 260 }
          ],
          allowInsertColumn: false,
          allowDeleteColumn: false,
          allowDeleteRow: true,
          tableOverflow: true,
          tableHeight: '420px',
          contextMenu: (obj, x, y) => {
            const items = [];

            if (y !== null && filteredRows[y]) {
              items.push({
                title: 'Delete row',
                onclick: () => {
                  const index = data.indexOf(filteredRows[y]);
                  if (index >= 0) {
                    data.splice(index, 1);
                    refreshSheet();
                    renderSummary();
                  }
                }
              });
            }

            return items;
          },
          onafterchanges: (_, records) => {
            let requiresFilterRefresh = false;
            records.forEach(({ x, y, value }) => {
              const row = filteredRows[y];
              if (!row) return;
              const key = columnKeys[x];
              row[key] = key === 'amount' ? Number(value) || 0 : value;
              if (key === 'stage') {
                requiresFilterRefresh = true;
              }
            });
            if (requiresFilterRefresh && stageFilter.value) {
              refreshSheet();
            }
            renderSummary();
          }
        });

        renderSummary();
      })
      .catch((err) => {
        console.error(err);
        handleLoadFailure('The spreadsheet engine did not load. Please refresh to retry.');
      });

    addForm.addEventListener('submit', (event) => {
      event.preventDefault();
      const formData = new FormData(addForm);
      const newRow = Object.fromEntries(formData.entries());
      newRow.id = safeId();
      newRow.amount = Number(newRow.amount) || 0;
      data.unshift(newRow);
      addForm.reset();
      if (stageSelect) stageSelect.value = stageOptions[0];
      refreshSheet();
      renderSummary();
    });

    stageFilter.addEventListener('change', refreshSheet);

    const toCsv = () => {
      const headers = ['Owner', 'Account', 'Opportunity', 'Amount', 'Stage', 'Close Date', 'Notes'];
      const rows = data.map((row) => [row.owner, row.account, row.opportunity, row.amount, row.stage, row.closeDate, row.notes]);
      return [headers, ...rows]
        .map((line) => line.map((field) => `"${String(field ?? '').replace(/"/g, '""')}"`).join(','))
        .join('\n');
    };

    exportCsvBtn.addEventListener('click', () => {
      const csv = toCsv();
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'salesforce-sheet.csv';
      link.click();
      URL.revokeObjectURL(url);
    });

    copyBtn.addEventListener('click', async () => {
      const csv = toCsv();
      try {
        await navigator.clipboard.writeText(csv);
        copyBtn.textContent = '‚úÖ Copied';
        setTimeout(() => (copyBtn.textContent = 'üìã Copy table'), 1500);
      } catch (err) {
        copyBtn.textContent = 'Clipboard blocked';
        copyBtn.classList.add('text-rose-600');
      }
    });

    renderSummary();
  })();
</script>
