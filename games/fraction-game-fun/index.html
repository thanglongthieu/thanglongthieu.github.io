<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fraction Party Game</title>
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at top, #1f1147, #050510);
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      overflow: hidden;
      touch-action: none;
      -webkit-user-select: none;
      user-select: none;
    }

    .app {
      box-sizing: border-box;
      width: 100%;
      height: 100%;
      padding: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 8px;
    }

    .header {
      text-align: center;
    }

    .title {
      font-size: 22px;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 13px;
      opacity: 0.8;
    }

    .top-bar {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
    }

    .stats span {
      margin-left: 10px;
    }

    .badge {
      border-radius: 999px;
      padding: 2px 8px;
      background: rgba(255,255,255,0.08);
      font-size: 11px;
    }

    .timer-bar-wrapper {
      margin-top: 6px;
      width: 100%;
      height: 8px;
      background: rgba(0,0,0,0.4);
      border-radius: 999px;
      overflow: hidden;
    }

    .timer-bar {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #34c759, #ffcc00, #ff3b30);
      transform-origin: left center;
      transform: scaleX(1);
      transition: transform 0.1s linear;
    }

    .game-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      text-align: center;
    }

    .mode-tag {
      font-size: 12px;
      opacity: 0.9;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.35);
      display: inline-block;
    }

    .question-text {
      font-size: 16px;
      opacity: 0.9;
      min-height: 22px;
    }

    .given-box {
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(0,0,0,0.35);
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      min-width: 160px;
    }

    .given-label {
      font-size: 11px;
      opacity: 0.8;
    }

    .fraction-big {
      font-size: 34px;
      font-weight: 600;
    }

    .answers {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      width: 100%;
      max-width: 360px;
    }

    .answer-btn {
      padding: 12px 8px;
      font-size: 20px;
      border-radius: 12px;
      border: none;
      background: rgba(15,15,35,0.95);
      color: #fff;
      box-shadow: 0 3px 8px rgba(0,0,0,0.7);
      transition: transform 0.08s ease, background-color 0.1s ease, box-shadow 0.08s ease;
    }

    .answer-btn span.small {
      display: block;
      font-size: 11px;
      opacity: 0.7;
      margin-top: 2px;
    }

    .answer-btn:active {
      transform: translateY(1px) scale(0.97);
      box-shadow: 0 2px 5px rgba(0,0,0,0.6);
    }

    .answer-btn.correct {
      background: #1c8f3f;
      box-shadow: 0 3px 10px rgba(48,209,88,0.7);
    }

    .answer-btn.wrong {
      background: #b3261e;
      box-shadow: 0 3px 10px rgba(255,69,58,0.7);
    }

    .feedback {
      font-size: 16px;
      min-height: 24px;
    }

    .feedback.good {
      color: #30d158;
      animation: popGood 0.4s;
    }

    .feedback.bad {
      color: #ff453a;
      animation: popBad 0.4s;
    }

    @keyframes popGood {
      0% { transform: scale(1); opacity: 0.6; }
      50% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes popBad {
      0% { transform: scale(1); opacity: 0.6; }
      50% { transform: scale(0.9); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    .combo-bar {
      font-size: 13px;
      opacity: 0.9;
    }

    .combo-count {
      font-weight: 600;
    }

    .footer {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .start-btn {
      padding: 9px 22px;
      font-size: 16px;
      border-radius: 999px;
      border: none;
      background: #0a84ff;
      color: #fff;
      box-shadow: 0 4px 12px rgba(10,132,255,0.6);
      transition: transform 0.08s ease, box-shadow 0.08s ease;
    }

    .start-btn:active {
      transform: translateY(1px) scale(0.97);
      box-shadow: 0 2px 6px rgba(10,132,255,0.5);
    }

    .hint-bottom {
      font-size: 12px;
      text-align: center;
      opacity: 0.8;
    }

    .emoji-burst {
      position: fixed;
      left: 50%;
      top: 45%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      font-size: 28px;
      opacity: 0;
      animation: burst 0.5s forwards;
    }

    @keyframes burst {
      0% { transform: translate(-50%, -50%) scale(0.7); opacity: 0; }
      40% { transform: translate(-50%, -60%) scale(1.2); opacity: 1; }
      100% { transform: translate(-50%, -70%) scale(0.8); opacity: 0; }
    }
  </style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="title">Fraction Party üéâ</div>
    <div class="subtitle">Simplify & compare fractions. Get combos, bonus time & high score!</div>
    <div class="top-bar">
      <div>
        ‚è± <span id="time">60</span>s
        <span class="badge">Level: <span id="level">1</span></span>
      </div>
      <div class="stats">
        <span>Score: <span id="score">0</span></span>
        <span>Best: <span id="best">0</span></span>
        <span>üî• Combo: <span id="combo">0</span>x</span>
      </div>
    </div>
    <div class="timer-bar-wrapper">
      <div id="timerBar" class="timer-bar"></div>
    </div>
  </div>

  <div class="game-area">
    <div id="modeTag" class="mode-tag">Mode: Simplify</div>
    <div class="question-text" id="questionText">
      Tap ‚ÄúStart‚Äù to begin. You‚Äôll see two kinds of questions:
      simplify & ‚Äúwhich is largest?‚Äù.
    </div>

    <div class="given-box" id="givenBox">
      <div class="given-label" id="givenLabel">Fraction to simplify</div>
      <div class="fraction-big" id="givenFraction">‚Äî</div>
    </div>

    <div class="answers">
      <button class="answer-btn" data-index="0"><span class="text"></span><span class="small"></span></button>
      <button class="answer-btn" data-index="1"><span class="text"></span><span class="small"></span></button>
      <button class="answer-btn" data-index="2"><span class="text"></span><span class="small"></span></button>
      <button class="answer-btn" data-index="3"><span class="text"></span><span class="small"></span></button>
    </div>

    <div class="feedback" id="feedback"></div>
    <div class="combo-bar" id="comboBar">
      Combos give bonus score and a little extra time. Don‚Äôt break the streak!
    </div>
  </div>

  <div class="footer">
    <button id="startBtn" class="start-btn">Start / Restart</button>
    <div class="hint-bottom">
      iPhone: just tap the answer.  
      ‚úÖ Faster correct answers ‚Üí more score & bonus time.  
      ‚ùå Wrong answers break your combo.
    </div>
  </div>
</div>

<script>
  // DOM
  const timeSpan = document.getElementById('time');
  const scoreSpan = document.getElementById('score');
  const bestSpan = document.getElementById('best');
  const levelSpan = document.getElementById('level');
  const comboSpan = document.getElementById('combo');
  const timerBar = document.getElementById('timerBar');
  const modeTag = document.getElementById('modeTag');
  const questionText = document.getElementById('questionText');
  const givenBox = document.getElementById('givenBox');
  const givenLabel = document.getElementById('givenLabel');
  const givenFractionEl = document.getElementById('givenFraction');
  const feedbackEl = document.getElementById('feedback');
  const comboBar = document.getElementById('comboBar');
  const startBtn = document.getElementById('startBtn');
  const answerButtons = Array.from(document.querySelectorAll('.answer-btn'));

  // state
  let score = 0;
  let best = 0;
  let timeLeft = 60;
  let totalTime = 60;
  let timerId = null;
  let running = false;
  let level = 1;
  let combo = 0;

  let currentMode = 'simplify'; // 'simplify' | 'compare'
  let currentDisplayFrac = null; // simplify mode
  let currentCorrectFrac = null;
  let correctIndex = -1;
  let compareFractions = []; // for compare mode

  // local storage
  try {
    const stored = localStorage.getItem('fractionPartyBest');
    if (stored !== null) {
      best = Number(stored) || 0;
      bestSpan.textContent = best;
    }
  } catch(e) {}

  // helpers
  function gcd(a, b) {
    a = Math.abs(a);
    b = Math.abs(b);
    while (b !== 0) {
      const t = b;
      b = a % b;
      a = t;
    }
    return a || 1;
  }

  function simplify(n, d) {
    const g = gcd(n, d);
    return { n: n / g, d: d / g };
  }

  function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function fracToStr(fr) {
    return `${fr.n}/${fr.d}`;
  }

  function sameFrac(a, b) {
    return a.n === b.n && a.d === b.d;
  }

  function fracValue(fr) {
    return fr.n / fr.d;
  }

  function updateTimerBar() {
    const ratio = Math.max(0, timeLeft / totalTime);
    timerBar.style.transform = `scaleX(${ratio})`;
  }

  function updateComboDisplay() {
    comboSpan.textContent = combo;
    if (combo >= 3) {
      comboBar.textContent = `üî• Combo ${combo}x! Extra points & a little extra time!`;
    } else if (combo > 0) {
      comboBar.textContent = `Combo ${combo}x ‚Äì keep going!`;
    } else {
      comboBar.textContent = 'Combos give bonus score and a little extra time. Don‚Äôt break the streak!';
    }
  }

  function bumpScore(base) {
    let multiplier = 1 + Math.floor(combo / 3) * 0.5; // 1x, 1.5x, 2x, ...
    const gained = Math.round(base * multiplier);
    score += gained;
    scoreSpan.textContent = score;
    if (score > best) {
      best = score;
      bestSpan.textContent = best;
      try {
        localStorage.setItem('fractionPartyBest', String(best));
      } catch(e) {}
    }
  }

  function addTimeBonus(amount) {
    timeLeft = Math.min(totalTime, timeLeft + amount);
    timeSpan.textContent = Math.max(0, Math.floor(timeLeft));
    updateTimerBar();
  }

  function burstEmoji(char) {
    const el = document.createElement('div');
    el.className = 'emoji-burst';
    el.textContent = char;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 550);
  }

  // question generators
  function genSimplifyQuestion() {
    currentMode = 'simplify';
    modeTag.textContent = 'Mode: Simplify';
    givenBox.style.display = 'inline-flex';
    givenLabel.textContent = 'Fraction to simplify';

    // base simplified proper fraction
    let base;
    while (true) {
      const maxN = 4 + level * 2;
      const maxD = 6 + level * 3;
      const n0 = randInt(1, Math.min(9, maxN));
      const d0 = randInt(2, Math.min(15, maxD));
      if (gcd(n0, d0) === 1 && n0 < d0) {
        base = { n: n0, d: d0 };
        break;
      }
    }

    const k = randInt(2, 6);
    currentCorrectFrac = base;
    currentDisplayFrac = { n: base.n * k, d: base.d * k };
    givenFractionEl.textContent = fracToStr(currentDisplayFrac);
    questionText.textContent = 'Simplify this fraction (lowest terms).';

    const answers = [base];
    while (answers.length < 4) {
      let n = base.n + randInt(-3, 3);
      let d = base.d + randInt(-3, 3);
      if (n <= 0 || d <= 0 || n >= d) continue;
      const s = simplify(n, d);
      if (!answers.some(fr => sameFrac(fr, s))) {
        answers.push(s);
      }
    }

    // shuffle
    for (let i = answers.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [answers[i], answers[j]] = [answers[j], answers[i]];
    }

    correctIndex = answers.findIndex(fr => sameFrac(fr, base));

    answerButtons.forEach((btn, idx) => {
      const t = btn.querySelector('.text');
      const s = btn.querySelector('.small');
      t.textContent = fracToStr(answers[idx]);
      s.textContent = 'simplified';
      btn.classList.remove('correct', 'wrong');
      btn.disabled = !running;
    });
  }

  function genCompareQuestion() {
    currentMode = 'compare';
    modeTag.textContent = 'Mode: Which is largest?';
    givenBox.style.display = 'none';
    questionText.textContent = 'Which fraction is the largest? Tap it!';

    compareFractions = [];
    const count = 4;
    while (compareFractions.length < count) {
      const maxN = 4 + level * 2;
      const maxD = 6 + level * 3;
      let n = randInt(1, Math.min(12, maxN));
      let d = randInt(2, Math.min(18, maxD));
      if (n >= d) continue; // proper only for now
      const s = simplify(n, d);
      if (!compareFractions.some(fr => sameFrac(fr, s))) {
        compareFractions.push(s);
      }
    }

    const sorted = [...compareFractions].sort((a, b) => fracValue(b) - fracValue(a));
    const largest = sorted[0];
    correctIndex = compareFractions.findIndex(fr => sameFrac(fr, largest));

    answerButtons.forEach((btn, idx) => {
      const t = btn.querySelector('.text');
      const s = btn.querySelector('.small');
      t.textContent = fracToStr(compareFractions[idx]);
      s.textContent = 'tap the biggest';
      btn.classList.remove('correct', 'wrong');
      btn.disabled = !running;
    });
  }

  function generateQuestion() {
    // pick mode depending on level and randomness
    if (level < 3) {
      // mostly simplify, sometimes compare
      currentMode = Math.random() < 0.7 ? 'simplify' : 'compare';
    } else {
      currentMode = Math.random() < 0.45 ? 'simplify' : 'compare';
    }

    if (currentMode === 'simplify') genSimplifyQuestion();
    else genCompareQuestion();

    feedbackEl.textContent = '';
    feedbackEl.className = 'feedback';
  }

  function startGame() {
    running = true;
    score = 0;
    level = 1;
    combo = 0;
    totalTime = 60;
    timeLeft = totalTime;
    scoreSpan.textContent = score;
    levelSpan.textContent = level;
    timeSpan.textContent = Math.floor(timeLeft);
    updateTimerBar();
    updateComboDisplay();
    feedbackEl.textContent = '';
    feedbackEl.className = 'feedback';
    questionText.textContent = 'Ready‚Ä¶ go! üëá';

    if (timerId) clearInterval(timerId);
    timerId = setInterval(() => {
      timeLeft -= 1;
      if (timeLeft < 0) timeLeft = 0;
      timeSpan.textContent = Math.floor(timeLeft);
      updateTimerBar();
      if (timeLeft <= 0) endGame();
    }, 1000);

    generateQuestion();
  }

  function endGame() {
    running = false;
    if (timerId) {
      clearInterval(timerId);
      timerId = null;
    }
    answerButtons.forEach(btn => btn.disabled = true);
    feedbackEl.textContent = `Time up! Final score: ${score}`;
    feedbackEl.className = 'feedback bad';
    combo = 0;
    updateComboDisplay();
    questionText.textContent = 'Tap ‚ÄúStart‚Äù to play again!';
  }

  function levelUpMaybe() {
    const newLevel = 1 + Math.floor(score / 10);
    if (newLevel > level) {
      level = newLevel;
      levelSpan.textContent = level;
      burstEmoji('‚≠ê');
      // slightly increase total time as game gets harder (but not too much)
      totalTime = 60 + Math.min(20, (level - 1) * 3);
      if (timeLeft < 10) {
        // small mercy refill
        timeLeft += 5;
      }
      updateTimerBar();
    }
  }

  function handleAnswer(idx, btn) {
    if (!running) return;

    answerButtons.forEach(b => b.classList.remove('correct', 'wrong'));

    const quickBonus = Math.max(0, Math.min(5, Math.floor(timeLeft % 6))); // tiny speed bonus

    if (idx === correctIndex) {
      btn.classList.add('correct');
      combo++;
      updateComboDisplay();
      const base = 1 + (currentMode === 'compare' ? 1 : 0); // compare slightly higher base
      bumpScore(base + quickBonus);
      feedbackEl.textContent = combo >= 3
        ? `‚úÖ Correct! Combo ${combo}x! (+${base + quickBonus} pts)`
        : `‚úÖ Correct! (+${base + quickBonus} pts)`;
      feedbackEl.className = 'feedback good';

      // bonus time small (+1s, +2s if high combo)
      const timeBonus = combo >= 5 ? 2 : 1;
      addTimeBonus(timeBonus);

      burstEmoji(['üéâ','‚ú®','ü§©'][randInt(0,2)]);
      levelUpMaybe();
    } else {
      btn.classList.add('wrong');
      const correctBtn = answerButtons[correctIndex];
      if (correctBtn) correctBtn.classList.add('correct');
      feedbackEl.textContent = '‚ùå Wrong! Combo reset.';
      feedbackEl.className = 'feedback bad';
      combo = 0;
      updateComboDisplay();
      burstEmoji('üí•');
    }

    setTimeout(() => {
      if (running) generateQuestion();
    }, 700);
  }

  // events
  answerButtons.forEach((btn, idx) => {
    btn.addEventListener('pointerdown', (e) => {
      e.preventDefault();
      handleAnswer(idx, btn);
    });
  });

  startBtn.addEventListener('pointerdown', (e) => {
    e.preventDefault();
    startGame();
  });

  // initial
  answerButtons.forEach(btn => {
    btn.disabled = true;
    const t = btn.querySelector('.text');
    const s = btn.querySelector('.small');
    t.textContent = '--';
    s.textContent = '';
  });
</script>
</body>
</html>
