<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dodge Game Fullscreen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #050510;
    width: 100%;
    height: 100%;
    overflow: hidden; /* prevent scroll/bounce */
    touch-action: none;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
  }

  #gameCanvas {
    display: block;
    margin: 0;
    padding: 0;
    touch-action: none;
    background: #141428;
  }

  #topUI {
    position: fixed;
    top: env(safe-area-inset-top, 0);
    width: 100%;
    text-align: center;
    color: white;
    font-family: -apple-system, sans-serif;
    font-size: 18px;
    padding: 8px 0;
    z-index: 10;
    pointer-events: none;
  }

  #startBtn {
    position: fixed;
    bottom: env(safe-area-inset-bottom, 10px);
    left: 50%;
    transform: translateX(-50%);
    padding: 10px 22px;
    background: #0a84ff;
    color: white;
    border-radius: 10px;
    border: none;
    font-size: 18px;
    z-index: 20;
  }
</style>
</head>
<body>

<div id="topUI">
  Time: <span id="time">0.0</span>s
</div>

<canvas id="gameCanvas"></canvas>
<button id="startBtn">Start / Restart</button>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  const timeSpan = document.getElementById("time");
  const startBtn = document.getElementById("startBtn");

  let W, H;

  function resizeCanvas() {
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
  }

  // Resize canvas for iPhone SE full screen
  window.addEventListener("resize", resizeCanvas);
  window.addEventListener("orientationchange", () => {
    setTimeout(resizeCanvas, 200);
  });

  resizeCanvas();

  // ------- GAME LOGIC (same as before) -------
  const player = { x: 0, y: 0, radius: 14 };
  let obstacles = [];
  let running = false;
  let startTime = 0;
  let lastFrame = 0;
  let lastSpawn = 0;
  let spawnInterval = 900;

  function startGame() {
    obstacles = [];
    spawnInterval = 900;
    running = true;
    startTime = performance.now();
    lastFrame = startTime;
    lastSpawn = startTime;

    player.x = W / 2;
    player.y = H - 70;

    timeSpan.textContent = "0.0";
    requestAnimationFrame(loop);
  }

  function spawn(now) {
    const size = 20 + Math.random() * 25;
    const x = size/2 + Math.random() * (W - size);
    const elapsed = (now - startTime)/1000;

    const speed = 150 + elapsed * 30 + Math.random()*40;

    obstacles.push({ x, y: -size, size, speed });
  }

  function update(dt, now) {
    if (now - lastSpawn > spawnInterval) {
      spawn(now);
      lastSpawn = now;
      spawnInterval = Math.max(300, spawnInterval - 10);
    }

    for (const o of obstacles) o.y += o.speed * dt;
    obstacles = obstacles.filter(o => o.y < H + o.size);

    for (const o of obstacles) {
      const dx = player.x - o.x;
      const dy = player.y - o.y;
      const half = o.size/2;
      const distX = Math.abs(dx);
      const distY = Math.abs(dy);

      const closestX = Math.max(-half, Math.min(distX, half));
      const closestY = Math.max(-half, Math.min(distY, half));

      const distSq = (distX - closestX)**2 + (distY - closestY)**2;
      if (distSq < player.radius**2) {
        gameOver(now);
        return;
      }
    }

    const elapsed = (now - startTime)/1000;
    timeSpan.textContent = elapsed.toFixed(1);
  }

  function draw() {
    ctx.clearRect(0, 0, W, H);

    ctx.fillStyle = "#3cc1ff";
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.radius, 0, Math.PI*2);
    ctx.fill();

    ctx.fillStyle = "#ff3b30";
    for (const o of obstacles) {
      ctx.fillRect(o.x - o.size/2, o.y - o.size/2, o.size, o.size);
    }
  }

  function loop(now) {
    if (!running) return;

    const dt = (now - lastFrame) / 1000;
    lastFrame = now;

    update(dt, now);
    draw();

    requestAnimationFrame(loop);
  }

  function gameOver(now) {
    running = false;
    const survived = (now - startTime)/1000;
    alert("Game Over! Survived: " + survived.toFixed(1) + "s");
  }

  // --- Touch/Drag Controls ---
  function movePlayer(x) {
    player.x = Math.max(player.radius, Math.min(W - player.radius, x));
  }

  canvas.addEventListener("touchstart", e => {
    e.preventDefault();
    movePlayer(e.touches[0].clientX);
  }, {passive:false});

  canvas.addEventListener("touchmove", e => {
    e.preventDefault();
    movePlayer(e.touches[0].clientX);
  }, {passive:false});

  canvas.addEventListener("mousemove", e => {
    if (e.buttons & 1) movePlayer(e.clientX);
  });

  startBtn.addEventListener("click", startGame);
  startBtn.addEventListener("touchstart", e => {
    e.preventDefault();
    startGame();
  }, {passive:false});
</script>
</body>
</html>
